<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Семинар 7: Конец 16-битной эпохи и условные переходы - Теория</title>
</head>
<body>
<div style="white-space: pre-wrap;">
Ура! Мы с вами сделали почти невозможное и ценой невероятных усилий наверстали материал и ликвидировали отставание! Поздравляю! Спасибо всем, что пришли на дополнительное занятие!
Далее, надеюсь, мы войдём в привычное русло, и если не случится каких-либо ещё катаклизмов (например, в виде болезни или если нам не отменят внезапно занятие), то далее всё пойдёт по плану.

Ну а теперь, как обычно, письмо с материалами по вчерашнему семинару.

Сначала насчёт теории.
<ol>
<li>Мы начали с того, что прошли <b>умножение и деление</b>. <a href="http://web.archive.org/web/20150528051836/http://www.kolasc.net.ru/cdo/programmes/assembler/mul.html" target="_blank">mul</a> и <a href="http://web.archive.org/web/20150515110326/http://www.kolasc.net.ru/cdo/programmes/assembler/div.html" target="_blank">div</a>, наверное, одни из самых сложных команд, которые мы рассматриваем.
Их синтаксис и схему их работы можно смотреть в презентациях Коротина, на сайте в справочнике по командам Ассемблера (см. ниже в разделе про команды), а также шпаргалку в моей <a href="../Materials/Assembler.pdf" target="_blank">табличке</a>.
</li>
<li>Далее мы взяли способы <b>адресации памяти</b>.
Я, наверное, лучше здесь распишу, чем указывать ссылки на презентации Коротина, чтобы не путать вас различиями между синтаксисами TASM и NASM (хотя, кто хочет, может посмотреть <a href="../Korotin_2010/Лекция 4.ppsx" target="_blank">Лекции 4</a> и <a href="../Korotin_2010/Лекция 5.ppsx" target="_blank">5</a> выборочно).
<ul>
Итак,
<li><b>прямая адресация</b> может быть
<ul>
<li><b>абсолютной</b>: "<tt>mov dx, a</tt>" - записывается в <tt>dx</tt> <b><u>адрес</u></b> переменной <tt>a</tt>, но не её значение (в <b>NASM</b>!);
или непосредственно константой: "<tt>mov dx, 402000</tt>" - но так делать плохо;
</li>
<li><b>абсолютной со смещением</b>: "<tt>mov dx, a + 15</tt>" - адрес "<tt>a+15</tt>" вычисляется на этапе компиляции/линковки и просто подставляется другая константа;
</li>
<li><b>относительной</b>: "<tt>jmp $ + 4</tt>" - прыжок на 4 байта вперёд относительно точки текущего положения в коде, которое обозначается символом <tt>$</tt>;
</li></ul></li>
<li><b>косвенная адресация</b> - это доступ к памяти с помощью указания в квадратных скобках адреса с помощью регистров, например:
<ul>
<li><b>базовая</b>: "<tt>mov dx, [bx]</tt>" - в регистре bx (который зовётся "базой") хранится адрес;
</li>
<li><b>базовая со смещением</b>: "<tt>mov dx, [bx+15]</tt>" - ну, думаю, тут всё понятно;
можно в качестве смещения взять символьное имя переменной, получится
</li>
<li><b>индексная со смещением</b> (почти то же самое, что и <b>базовая со смещением</b>): "<tt>mov dx, [a+si]</tt>" - тут основная часть адреса хранится в <tt>a</tt>, в <tt>si</tt> - индекс (если <tt>a</tt> - массив);
(разумеется, можно написать и <tt>[si+a]</tt>, ничего не изменится, главное, что <tt>si</tt> и <tt>di</tt> - <b><i>индексные</i></b> регистры, а не <b><i>базовые</i></b>, как <tt>bx</tt> и <tt>bp</tt>)
</li>
<li><b>базово-индексная</b>: "<tt>mov dx, [bx+si]</tt>" - один из базовых регистров (<tt>bx</tt> или <tt>bp</tt>) и один из индексных (<tt>si</tt> или <tt>di</tt>); лучше выбирать <tt>bx</tt>, т.к. по умолчанию он использует сегментный регистр <tt>ds</tt>, а <tt>bp</tt> - использует <tt>ss</tt>!
другие регистры в DOS недопустимы! но в 32-битных и 64-битных системах разрешены любые регистры;
</li>
<li><b>базово-индексная со смещением</b>: "<tt>mov dx, [a+bx+si+15]</tt>" - где <tt>a+15</tt> сливается в одну константу.
</li></ul>
А в 32-битных и 64-битных системах допустимы даже такие выражения:
<tt>mov edx, [a+eax+ecx*4+15]</tt>
Главное правило - используется 0, 1 или 2 регистра, один из которых может быть умножен на 2, 4 или 8. Ну плюс ещё константы (смещение). Более сложные выражения недопустимы, другие множители тоже недопустимы.
</li>
</ul>
</li>
<li><b>Условные и безусловные переходы, регистр флагов.</b>
<a href="../Materials/flags_jcc.pdf" target="_blank">flags_jcc.pdf</a> - электронная версия таблички про <b>регистр флагов и команды перехода</b>.
</li>
<li>Ну и напомню <b>команды</b>, которые мы с вами в понедельник прошли:
<ul>
<li><a href="../Korotin_2010" target="_blank">Коротин-2010</a>:
<ul>
<li>Умножение и деление: <a href="../Korotin_2010/Лекция 5.ppsx" target="_blank">Лекция 5</a>, слайд 17.
</li>
<li>Команды cbw, cwd, cwde, cdq (и cdqe туда же - 64-bit only): <a href="../Korotin_2010/Лекция 5.ppsx" target="_blank">Лекция 5</a>, слайд 12;
</li>
<li>Команды-исключения, у которых операнды могут быть (точнее, <u>должны</u>) разных размеров: movsx, movzx (32-bit only) - <a href="../Korotin_2010/Лекция 5.ppsx" target="_blank">Лекция 5</a>, слайд 13;
</li>
<li>Регистр флагов и описание отдельных флажков: <a href="../Korotin_2010/Lekcija_2.ppsx" target="_blank">Лекция 2</a>, слайды 31-33;
</li>
<li>Команды для организации условий, циклов: <a href="../Korotin_2010/Лекция 5.ppsx" target="_blank">Лекция 5</a>, слайд 38;
</li>
<li>Блок-схема команды loop: слайд 39;
</li>
<li>ну и некоторые другие, можете поискать по этим презентациям.
</li></ul></li>
<li><a href="http://web.archive.org/web/20150512184626/http://www.kolasc.net.ru/cdo/programmes/assembler/tc.html" target="_blank">Справочник по командам Ассемблера</a>:
<ul>
<li>Команды целочисленного деления и умножения:
<a href="http://web.archive.org/web/20150515110326/http://www.kolasc.net.ru/cdo/programmes/assembler/div.html" target="_blank">div</a>, <a href="http://web.archive.org/web/20150702152108/http://www.kolasc.net.ru/cdo/programmes/assembler/idiv.html" target="_blank">idiv</a> и <a href="http://web.archive.org/web/20150528051836/http://www.kolasc.net.ru/cdo/programmes/assembler/mul.html" target="_blank">mul</a>, <a href="http://web.archive.org/web/20150702021303/http://www.kolasc.net.ru/cdo/programmes/assembler/imul.html" target="_blank">imul</a>;
</li>
<li>Команды расширения регистра al/ax/eax:
<a href="http://web.archive.org/web/20150528044636/http://www.kolasc.net.ru/cdo/programmes/assembler/cbw.html" target="_blank">cbw</a>, <a href="http://web.archive.org/web/20141220013352/http://www.kolasc.net.ru/cdo/programmes/assembler/cwd.html" target="_blank">cwd</a>, <a href="http://web.archive.org/web/20150528044636/http://www.kolasc.net.ru/cdo/programmes/assembler/cbw.html" target="_blank">cwde</a>, <a href="http://web.archive.org/web/20150528230755/http://www.kolasc.net.ru/cdo/programmes/assembler/cdq.html" target="_blank">cdq</a> (cdqe - для 64-бит);
</li>
<li>Команды расширения других регистров:
<a href="http://web.archive.org/web/20150528230806/http://www.kolasc.net.ru/cdo/programmes/assembler/movsx.html" target="_blank">movsx</a> (для 32- и 64- бит), <a href="http://web.archive.org/web/20150528230811/http://www.kolasc.net.ru/cdo/programmes/assembler/movzx.html" target="_blank">movzx</a> (для 32-бит);
</li>
<li>Условные переходы:
<a href="http://web.archive.org/web/20150607174719/http://www.kolasc.net.ru/cdo/programmes/assembler/cmp.html" target="_blank">cmp</a>, <a href="http://web.archive.org/web/20150607184427/http://www.kolasc.net.ru/cdo/programmes/assembler/test.html" target="_blank">test</a> - вычисление условия, установка флагов;
<a href="http://web.archive.org/web/20150429181353/http://www.kolasc.net.ru/cdo/programmes/assembler/jcc.html" target="_blank">jcc</a> - семейство команд условных переходов, которые проверяют флажки и делают или не делают прыжок;
</li>
<li>И Безусловный переход:
<a href="http://web.archive.org/web/20150511061954/http://www.kolasc.net.ru/cdo/programmes/assembler/jmp.html" target="_blank">jmp</a>;
</li>
<li>Команды специально для простейших циклов:
<a href="http://web.archive.org/web/20150514075720/http://www.kolasc.net.ru/cdo/programmes/assembler/loop.html" target="_blank">loop</a> (туда же <a href="http://web.archive.org/web/20150523012811/http://www.kolasc.net.ru/cdo/programmes/assembler/loope.html" target="_blank">loope, loopne</a>);
</li>
<li>И специально для loop-ов ещё одна команда условного перехода:
<a href="http://web.archive.org/web/20150429181353/http://www.kolasc.net.ru/cdo/programmes/assembler/jcc.html" target="_blank">jcxz, jecxz</a> (jrcxz - для 64-бит);
</li>
<li>Также по этой табличке изучаем/вспоминаем любую понравившуюся команду, например,
<a href="http://web.archive.org/web/20150522012823/http://www.kolasc.net.ru/cdo/programmes/assembler/mov.html" target="_blank">mov</a>, <a href="http://web.archive.org/web/20150514080334/http://www.kolasc.net.ru/cdo/programmes/assembler/add.html" target="_blank">add</a>, <a href="http://web.archive.org/web/20150608163650/http://www.kolasc.net.ru/cdo/programmes/assembler/sub.html" target="_blank">sub</a>, <a href="http://web.archive.org/web/20151112214016/http://www.kolasc.net.ru/cdo/programmes/assembler/inc.html" target="_blank">inc</a>, <a href="http://web.archive.org/web/20150413093942/http://www.kolasc.net.ru/cdo/programmes/assembler/dec.html" target="_blank">dec</a>, <a href="http://web.archive.org/web/20150528230857/http://www.kolasc.net.ru/cdo/programmes/assembler/neg.html" target="_blank">neg</a>, <a href="http://web.archive.org/web/20150529083226/http://www.kolasc.net.ru/cdo/programmes/assembler/lea.html" target="_blank">lea</a>.
</li>
</ul>
</li>
</ul>
</li>
</ol>
</div>
<div id="comments"></div>
<script src="comments.js"></script>
</body>
</html>
