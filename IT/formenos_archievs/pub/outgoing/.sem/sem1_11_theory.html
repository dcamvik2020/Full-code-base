<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Семинар 11: Функции с переменным числом параметров и рандом - Файлы и начала высшей информатики (списки) - Теория</title>
</head>
<body>
<div style="white-space: pre-wrap;">
<!--Материалы к семинару уже выложены на сервер, а здесь мы подведём некоторые итоги и соберём ссылки на них.-->
<ol>
<li><b>Функции с переменным числом параметров.</b> Пишете в заголовке функции минимум один фиксированный параметр, а дальше ставите троеточие (т.н. "эллипс", "эллипсис" (ellipsis)):
<tt>int func(int n, ...);</tt>
Добираетесь к переменным параметрам, отталкиваясь от последнего фиксированного, либо через указатели, либо с помощью макросов из <tt>stdarg.h</tt>:

<tt>    va_list v; <font color="green">//объявили магический "указатель", который будет двигаться по стеку, по параметрам</font>
    va_start(v, n); <font color="green">//настроили его на то, что лежит после последнего фиксированного параметра</font>
    ... = va_arg(v, int); <font color="green">//получаем доступ к очередному параметру; после этого v сдвигается на следующий</font>
    va_end(v); <font color="green">//как закончили, надо освободить выделенные ресурсы</font></tt>

Если хочется через указатели (в основном, в 32-битных компиляторах), то не надо забывать, что параметры располагаются гранулярностью по 4 или 8 байт (размерность машинного слова в 32 или 64 битах), даже если размер параметров меньше. Надо аккуратно кастовать приведение типов.
</li>
<li>Использование функции <b>псевдослучайного числа</b>:
<ol>
<li>Один раз (!) в начале программы с помощью функции <tt>srand</tt> инициализируем случайную последовательность, чтобы от запуска к запуску программы она была разная:
<tt>#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
    srand((unsigned)time(NULL));</tt>
Ещё раз, <b><u>не надо</u></b> вызывать <tt>srand</tt> в цикле!
</li>
<li>Затем вызываем функцию <tt>rand</tt> (а её уже можно в цикле):
<tt>    n = rand() % 100;</tt>
Функция <tt>rand()</tt> возвращает псевдослучайное число в диапазоне от <tt>0</tt> до <tt>RAND_MAX</tt> (которое равно обычно 2<sup>31</sup>-1 в Linux GCC и 2<sup>15</sup>-1 в Windows MinGW). Чтобы сократить этот диапазон, берём остаток от деления на верхнюю границу.
В этом примере n будет в диапазоне [0..99].
</li>
<li>Если результаты нас перестают удовлетворять, например, потому что получаются слишком похожие или слишком близкие значения, или потому, что максимальное число 2<sup>15</sup>-1, а не 2<sup>32</sup>-1, можно воспользоваться более профессиональным способом:
<tt>    n = (unsigned) (100 * (rand() / (RAND_MAX + 1.0)));</tt>
Естественно, вместо 100 может быть любое другое число; можно также прибавлять/отнимать константу, чтоб сдвинуть диапазон.
</li></ol></li>
<li><b>Файлы.</b> Ну, тут совсем всё просто. Справится любой школьник. Большинство задач на зачёте будут из серии обработать тем или иным образом данный файл (написать программу, выполняющую соответствующие действия с файлом).
</li>
<li>Дошли, наконец, до высших материй - до <b>списков</b>.
С литературой тут беда, поскольку уже начинаются разброд и шатания.
Кто-то реализовывает список с выделением головного служебного элемента, кто-то без, кто-то с барьером, кто-то с замыканием на начало (кольцевой список) и т.д. А я даю <a href="../C1/structures/list_demo.c" target="_blank">свой вариант</a>.
</li>
</ol>
</div>
<div id="comments"></div>
<script src="comments.js"></script>
</body>
</html>
