<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Урок 7: ReadLn в Си   #advanced_magic</title>
</head>
<body>
<div style="white-space: pre-wrap;">
Добрый вечер всем, кто жаждет овладеть новыми секретами мастерства, раздвинуть тесные рамки институтского курса и выйти далеко за границы сил Добра и Света. :-)
Следующие несколько недель я буду делиться с вами некоторыми своими <a href="../C2/adv" target="_blank">небольшими наработками</a>, которые, может быть, окажутся полезными для вас.
Я не буду говорить, что это идеальный код и образец для подражания, я уверен, вы напишете лучше. ;-)
А если вы в моём коде найдёте ещё и найдёте ошибки - это, будем считать, "высший пилотаж", я буду благодарен, если вы их исправите. :-)

Многие из вас, наверное, помнят, что в Паскале была замечательная функция <tt><b>ReadLn</b></tt>, которая позволяла считывать с экрана (или файла) строчку произвольной длины.
Поскольку язык Си (не C++) более низкоуровневый, то в нём самого такого типа - динамическая строка - нет, и все функции чтения так или иначе требуют указания размера буфера (запрещённый <tt><b>gets</b>()</tt> не в счёт), а сам буфер должен быть достаточного размера. Но что делать, если нужно в Си считать с экрана или из файла строчку целиком, но её максимальная длина не известна? Соответствующей стандартной библиотечной функции нет, но можно написать свою. Идея простая: считываем с помощью <tt><b>fgets</b>()</tt>, потом смотрим, есть ли в том, что считали, символ <font color="green">'\n'</font>. Если нет, то выделяем больше памяти под буфер (это, заодно, хороший пример использования функции <tt><b>realloc</b>()</tt>) и досчитываем остаток. Если опять не хватило, снова увеличиваем буфер и т.д.
В конечном итоге возвращается строка ровно такого размера, сколько было считано (привет, <tt><b>strdup</b>()</tt>!).
Единственное неудобство - надо всегда освобождать память из-под считанной строчки.
В <a href="../C2/adv" target="_blank">этой папке</a> находится небольшой демонстрационный пример <a href="../C2/adv/read_string.c" target="_blank">read_string.c</a>, копирующий текстовые файлы.
Если использовать макрос <tt><b>readln</b>()</tt>, то можно удобно читать не из файла, а с экрана.
Я думаю, этот метод можно было бы попробовать использовать в задачах прошлого семестра. Кому не лень - можете проверить.
</div>
<div id="comments"></div>
<script src="comments.js"></script>
</body>
</html>
